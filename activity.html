<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Activity Loadout | D2LA</title>
<meta id="meta-description" name="description" content="Default loadout description for Destiny 2 activities." />

    <!-- Essential OG tags -->
<meta property="og:title" content="D2LA - Destiny 2 Loadout Advisor" />
<meta property="og:description" content="D2LA is a Destiny 2 Loadout Advisor that helps Guardians discover curated PvE loadouts, tiered by activity and subclass." />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://poly-d2la.github.io/d2-loadout-advisor/" />
<meta property="og:image" content="images/websnap.png" />
  <!-- Twitter OG tags -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="D2LA - Destiny 2 Loadout Advisor" />
<meta name="twitter:description" content="Your curated PvE builds and activity-specific loadouts, assembled for endgame glory." />
<meta name="twitter:image" content="images/websnap.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
</head>
<body class="text-white min-h-screen flex flex-col bg-gradient-to-br from-gray-800 via-gray-900 to-pink-950">
<main class="flex-grow p-6">

  <!-- Navbar -->
<nav class="w-full bg-gradient-to-b from-black/80 via-gray-900/60 to-transparent text-white shadow backdrop-blur-sm border-b border-gray-700" x-data="{ open: false }">
  <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
    <!-- Logo -->
    <div class="text-lg font-bold tracking-wide">D2 Loadout Advisor</div>

    <!-- Desktop Nav -->
    <div class="hidden md:flex space-x-4 text-sm md:text-base">
      <a href="index.html" class="hover:text-blue-300 transition font-semibold">üí† Home</a>
      <a href="raids.html" class="hover:text-purple-300 transition font-semibold">üõ°Ô∏è Raids</a>
      <a href="dungeons.html" class="hover:text-teal-300 transition font-semibold">üï≥Ô∏è Dungeons</a>
    </div>

    <!-- Hamburger Button (Mobile) -->
    <button @click="open = !open" class="md:hidden focus:outline-none">
      <svg x-show="!open" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
      </svg>
      <svg x-show="open" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
      </svg>
    </button>
  </div>

  <!-- Mobile Dropdown -->
  <div x-show="open" class="md:hidden px-4 pb-4 space-y-2 text-sm">
    <a href="index.html" class="block hover:text-blue-300 font-semibold">üí† Home</a>
    <a href="raids.html" class="block hover:text-purple-300 font-semibold">üõ°Ô∏è Raids</a>
    <a href="dungeons.html" class="block hover:text-teal-300 font-semibold">üï≥Ô∏è Dungeons</a>
  </div>
</nav>

  <h1 id="activity-title" class="text-3xl md:text-5xl font-bold text-center mb-4 my-5">Loading...</h1>

  <!-- Activity Image -->
  <div class="flex justify-center mb-6">
    <div class="relative w-full max-w-3xl h-48 bg-gray-700 rounded-lg shadow-lg overflow-hidden">
      <div id="activity-image" class="absolute inset-0 flex items-center justify-center text-xl">[ Loading Graphic... ]</div>
    </div>
  </div>

  <!-- Difficulty Toggle -->
  <div class="flex justify-center gap-4 mb-8">
    <button onclick="setDifficulty('Normal')" id="normalBtn" class="px-4 py-2 rounded bg-blue-600 hover:bg-blue-500 transition">Normal</button>
    <button onclick="setDifficulty('Master')" id="masterBtn" class="px-4 py-2 rounded bg-red-600 hover:bg-red-500 transition">Master</button>
  </div>

  <!-- Encounter Sections -->
  <div id="encounter-container" class="space-y-6 max-w-4xl w-full mx-auto"></div>
  </main>

  <!-- Sticky Footer -->
  <footer class="w-full text-gray-500 text-[0.6rem] text-center py-1 border-t border-gray-800 bg-gradient-to-t from-black/70 via-gray-900/50 to-transparent backdrop-blur-sm leading-tight">
    Site created by Poly.<br />
    Loadout info is curated, compiled, and tested by 
    <a href="https://www.youtube.com/@TheAegisRelic" target="_blank" class="text-blue-400 hover:underline">üì∫ TheAegisRelic</a>. 
    View their 
    <a href="https://docs.google.com/spreadsheets/d/1JM-0SlxVDAi-C6rGVlLxa-J1WGewEeL8Qvq4htWZHhY/edit?gid=1087089423#gid=1087089423" target="_blank" class="text-blue-400 hover:underline">üìä Endgame Tierlist</a>.
  </footer>


<script>
  const params = new URLSearchParams(window.location.search);
  const type = params.get("type");
  const name = params.get("name");
  let currentLoadouts = {};
  let currentDifficulty = "Normal";

  function setDifficulty(level) {
    const masterBtn = document.getElementById("masterBtn");

    // ‚õî Block switching to Master if it's a dungeon
    if (type === "dungeon" && level === "Master") return;

    currentDifficulty = level;
    renderEncounters();

    // Restore previously open encounter
    const openDiv = document.querySelector("#encounter-container > div > div:not(.hidden)");
    const openId = openDiv?.id;
    if (openId) {
      const el = document.getElementById(openId);
      if (el) {
        el.classList.remove("hidden");
        const arrow = el.previousElementSibling.querySelector(".toggle-arrow");
        if (arrow) arrow.textContent = "‚ñ≤";
      }
    }

    document.getElementById("normalBtn").classList.toggle("opacity-60", level !== "Normal");

    if (masterBtn) {
      if (type === "dungeon") {
        masterBtn.style.display = "none";
      } else {
        masterBtn.style.display = "";
        masterBtn.classList.toggle("opacity-60", level !== "Master");
      }
    }
  }

  function renderEncounters() {
    const container = document.getElementById("encounter-container");
    container.innerHTML = "";

    Object.entries(currentLoadouts).forEach(([key, encounter]) => {
      const loadoutData = encounter.loadouts?.[currentDifficulty];
      if (!loadoutData) return;

      const collapseId = `encounter-${key}`;
      const section = document.createElement("div");

      const classColors = {
        Hunter: "text-blue-400",
        Titan: "text-red-400",
        Warlock: "text-yellow-300"
      };

      const badgeColors = {
        "Exotic Armour": "bg-yellow-600",
        "Primary": "bg-blue-700",
        "Energy": "bg-indigo-700",
        "Heavy": "bg-red-700"
      };

      section.innerHTML = `
        <div class="bg-gray-800 rounded-lg shadow overflow-hidden">
          <button onclick="toggleEncounter('${collapseId}')" class="w-full text-left px-4 py-3 flex justify-between items-center hover:bg-gray-700 transition">
            <h2 class="text-lg font-bold flex items-center gap-2">
              <span class="text-2xl">${encounter.icon || "üìå"}</span> ${encounter.displayName}
            </h2>
            <span class="text-gray-400 text-sm toggle-arrow">‚ñº</span>
          </button>
          <div id="${collapseId}" class="px-4 pb-4 hidden">
            ${encounter.image ? `<img src="${encounter.image}" alt="${encounter.displayName}" class="w-full h-40 object-cover rounded mb-4" />` : ""}
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              ${["Hunter", "Warlock", "Titan"].map(cls => {
                const items = loadoutData?.[cls];
                if (!items) return `<div><h3 class="text-lg font-bold ${classColors[cls]} mb-2">${cls}</h3><p class="text-gray-500 italic">No data</p></div>`;

                const renderedItems = items.map(({ label, item }) => {
                  const badge = badgeColors[label] || "bg-gray-600";
                  return `
                    <li>
                      <span class="inline-block px-2 py-0.5 text-xs font-semibold rounded ${badge} text-white mr-2">${label}</span>
                      ${item}
                    </li>`;
                }).join("");

                return `
                  <div>
                    <h3 class="text-lg font-bold ${classColors[cls]} mb-2 flex items-center gap-2">
                      ${cls}
                      <span class="px-2 py-1 text-xs rounded ${currentDifficulty === "Normal" ? "bg-blue-700" : "bg-red-700"} text-white">
                        ${currentDifficulty}
                      </span>
                    </h3>
                    <ul class="list-none ml-2 space-y-1 text-gray-300">
                      ${renderedItems}
                    </ul>
                  </div>
                `;
              }).join("")}
            </div>
          </div>
        </div>
      `;
      container.appendChild(section);
    });
  }

  function toggleEncounter(id) {
    const el = document.getElementById(id);
    const arrow = el.previousElementSibling.querySelector(".toggle-arrow");
    const isHidden = el.classList.contains("hidden");
    el.classList.toggle("hidden");
    arrow.textContent = isHidden ? "‚ñ≤" : "‚ñº";
  }

  function updateMeta(activity) {
    const title = activity.displayName || activity.name || "Activity";
    const description = activity.description || "Curated Destiny 2 loadouts for this activity.";

    document.title = `${title} | D2LA`;

    const descTag = document.querySelector('meta[name="description"]');
    if (descTag) descTag.setAttribute('content', description);

    const ogTitle = document.querySelector('meta[property="og:title"]');
    if (ogTitle) ogTitle.setAttribute('content', `${title} | D2LA`);

    const ogDesc = document.querySelector('meta[property="og:description"]');
    if (ogDesc) ogDesc.setAttribute('content', description);
  }

  fetch("data.json")
    .then(res => res.json())
    .then(data => {
      const activity = data?.[type + "s"]?.[name];
      if (!activity) {
        document.getElementById("activity-title").textContent = "Activity Not Found";
        return;
      }

      updateMeta(activity);

      document.getElementById("activity-title").textContent = activity.displayName;
      document.getElementById("activity-image").innerHTML =
        `<img src="${activity.image}" alt="${activity.displayName}" class="w-full h-full object-cover" />`;

      currentLoadouts = activity.encounters;
      renderEncounters();

      // ‚úÖ Hide Master button immediately for dungeons
      if (type === "dungeon") {
        const masterBtn = document.getElementById("masterBtn");
        if (masterBtn) masterBtn.style.display = "none";
      }
    })
    .catch(err => {
      console.error(err);
      document.getElementById("activity-title").textContent = "Error loading data";
    });

  const path = window.location.pathname;
  const navMap = {
    'index':    { id: 'nav-home',     bg: 'bg-blue-600',   text: 'text-white' },
    'raids':    { id: 'nav-raids',    bg: 'bg-purple-600', text: 'text-white' },
    'dungeons': { id: 'nav-dungeons', bg: 'bg-teal-600',   text: 'text-white' }
  };

  for (const key in navMap) {
    if (path.includes(key)) {
      const { id, bg, text } = navMap[key];
      const el = document.getElementById(id);
      if (el) el.classList.add(bg, text);
    }
  }
</script>
</body>
</html>